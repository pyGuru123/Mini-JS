<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Breakout</title>
	<style type="text/css">
		html, body {
			margin: 0;
			padding: 0;
			background: rgb(72, 72, 72);
		}

		canvas {
			position: absolute;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			background: #eee;
			border: 1.3px solid rgba(0, 0, 255, 0.5);
		}
	</style>
</head>
<body>
	<canvas width='288' height='512'></canvas>

	<script type="text/javascript">
		const canvas = document.querySelector('canvas');
		const ctx = canvas.getContext('2d');

		const WIDTH = canvas.width;
		const HEIGHT = canvas.height;

		let colors = ['#FAAB1C', '#2490E9','#E46E63', '#6C757D', '#75D5FD',
			  '#32A956', '#367055']
		let length = colors.length
		var color = get_color();

		var x = WIDTH / 2;
		var y = HEIGHT / 2;
		var radius = 10;
		var ball = new Ball(x, y, radius);

		var paddleWidth = 80;
		var paddleHeight = 10;
		var paddle = new Paddle(paddleWidth, paddleHeight);

		var rows = 3
		var cols = 3
		var bwidth = 80;
		var bheight = 20
		var bpadding = 10;
		var leftOffset = 14;
		var topOffset = 10;
		var bricks = [];
		for (let r=0; r<rows; r++) {
			for (let c=0; c<cols; c++) {
				var x = leftOffset + c * (bpadding +  bwidth);
				var y = topOffset + r * (bpadding + bheight);
				var brick = new Brick(x, y, bwidth, bheight);
				bricks.push(brick);
			}
		}

		// Canvas Update function

		function updateCanvas() {
			ctx.clearRect(0, 0, WIDTH, HEIGHT);
			ball.draw();
			ball.update();
			paddle.draw();
			for (let b = 0; b < bricks.length; b++){
				if (bricks[b].isalive) {
					bricks[b].draw();
					if (bricks[b].hasCollided(ball)) {
						bricks[b].isalive = false;
						ball.dy *= -1;
					}
				}
			}
		}

		var interval = setInterval(updateCanvas, 10);
		document.addEventListener('keydown', keyDown);
		document.addEventListener('keyup', keyUp);

		// Game Objects

		function Ball(x, y, radius) {
			this.x = x;
			this.y = y;
			this.radius = radius;

			this.dx = 2;
			this.dy = -2;

			this.draw = () => {
				ctx.beginPath();
				ctx.arc(this.x, this.y, this.radius, 0, Math.PI*2);
				ctx.fillStyle = color;
				ctx.fill();
				ctx.stroke();
				ctx.closePath();
			}

			this.update = () => {
				this.x += this.dx;
				this.y += this.dy;

				if (this.x + this.dx < this.radius || this.x + this.dx > WIDTH - this.radius) {
					this.dx *= -1
				}

				if (this.y + this.dy < this.radius) {
					this.dy *= -1;
				}
				else if (this.y + this.dy > HEIGHT - this.radius- paddle.height) {
					if (this.x > paddle.x && this.x < paddle.x + paddle.width) {
						this.dy *= -1;
					}
				}
				
				if (this.y + this.dy >= HEIGHT) {
					alert('Game Over');
					document.location.reload();
					clearInterval(interval);
				}
			}
		}

		function Paddle(width, height) {
			this.width = width;
			this.height = height;

			this.x = WIDTH / 2 - this.width / 2;
			this.y = HEIGHT - this.height;
			this.speed = 8;
			this.moveLeft = false;
			this.moveRight = false;

			this.draw = () => {
				ctx.beginPath();
				ctx.rect(this.x, this.y, this.width, this.height);
				ctx.fillStyle = color;
				ctx.fill();
				ctx.stroke();
				ctx.closePath();
			}

			this.update = () => {
				if (this.moveLeft) {
					if (this.x + this.speed > 0) {
						this.x -= this.speed;
					}
				}

				if (this.moveRight) {
					if (this.x + paddle.width < WIDTH) {
						this.x += this.speed;	
					}
				}
			}
		}

		function Brick(x, y, width, height) {
			this.x = x;
			this.y  =y;
			this.width = width;
			this.height = height;
			this.isalive = true;

			this.draw = () => {
				ctx.beginPath();
				ctx.rect(this.x, this.y, this.width, this.height);
				ctx.fillStyle = color;
				ctx.fill();
				ctx.stroke();
				ctx.closePath();
			}

			this.hasCollided = (ball) => {
				if (ball.x > this.x && ball.x < this.x + this.width &&
					ball.y > this.y && ball.y < this.y + this.height) {
					return true;
				}

				return false;
			}
		}

		// Functions & Event Handlers

		function keyDown(event) {
			if (event.key == 'ArrowLeft') {
				paddle.moveLeft = true;
			}

			else if (event.key == 'ArrowRight') {
				paddle.moveRight = true;
			}

			paddle.update();
		}

		function keyUp(event) {
			if (event.key == 'ArrowLeft') {
				paddle.moveLeft = false;
			}

			else if (event.key == 'ArrowRight') {
				paddle.moveRight = false;
			}
			paddle.update();
		}

		function get_color() {
			let index = Math.floor(Math.random() * length) + 1;
			color = colors[index];
			return color;
		}

		function print() {
			console.log(arguments)
		}
	</script>
</body>
</html>