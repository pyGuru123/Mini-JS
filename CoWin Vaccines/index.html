<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>CoWin Slots</title>

	<style type="text/css">
		@import url('https://fonts.googleapis.com/css2?family=Courgette&family=Open+Sans&display=swap');

		html, body {
			margin: 0;
			padding: 0;
			background-color: rgb(21,24,29);
		}

		.main {
			width: 330px;
			height: 550px;
			top: 50%;
			left: 50%;
			position: absolute;
			transform: translate(-50%, -50%);
		}

		.header {
			width: 100%;
			height: 60px;
			background-color: rgb(18,72,158);
		}

		.header p {
			color: white;
			text-align: center;
			margin: auto;
			line-height: 60px;
			font-size: 24px;
			font-family: 'Open Sans', sans-serif;
			user-select: none;
		}

		.logo {
			width: inherit;
			height: 120px;
			background-color: rgb(16,25,32);
		}

		.logo img {
			width: 98%;
			height: 110px;
			margin: auto;
			border: 2px solid rgb(16,25,32);
		}

		.searchdiv {
			background-color: rgb(16,25,32);
			width: inherit;
			height: 360px;
			overflow-y: auto;
		}

		::-webkit-scrollbar {
		    width: 0px;
		    background: transparent;
		}

		.method {
			border: 3px solid rgb(16,25,32);
			outline: none;
			font-family: 'Open Sans', sans-serif;
			font-size: 16px;
			font-weight: 500;
			margin-left: 20px;
			padding-bottom: 4px;
			color: rgb(124,126,125);
			border-radius: 5px;
			background-color: rgb(16,25,32);
		}

		.bydist {
			margin-left: -1px;
		}

		.box {
			width: 90%;
			left: 50%;
			position: absolute;
			transform: translate(-50%);
			height: 300px;
			background-color: rgb(18,18,18);
			border-radius: 12px;
		}

		label {
			display: block;
			color : rgb(217,217,217);
			font-size: 20px;
			font-family: 'Open Sans', sans-serif;
			margin-left: 22px;
			margin-top: 15px;
			user-select: none;
		}

		.labelup {
			margin-top: -4px;
		}

		input[type="input"] {
			border: none;
			outline: none;
			display: block;
			color: rgb(92,92,92);
			font-family: 'Open Sans', sans-serif;
			font-size: 18px;
			font-weight: 500;
			margin-left: 20px;
			margin-top: -1px;
			margin-bottom: 0px;
			padding-bottom: 4px;
			border-bottom: 0.5px solid rgb(18,18,18);
			background-color: inherit;
		}

		input:focus {
			border-bottom: 0.5px solid rgb(12, 12, 12);
		}

		input[type="radio"]{
			margin-left: 24px;
			color: white;
		}

		.radio {
			color: rgb(92,92,92);
			user-select: none;
			font-family: 'Open Sans', sans-serif;
			font-size: 18px;
			font-weight: 500;
			margin-right: 30px;
		}

		.searchpin {
			border: none;
			outline: none;
			width: 80%;
			margin-left: 30px;
			margin-top: 30px;
			padding: 7px;
			color: rgb(92,92,92);
			font-size: 22px;
			font-family: 'Open Sans', sans-serif;
			background-color: rgb(10, 10, 10);
			border: 2px solid rgb(18,72,158);
			border-radius: 8px;
			cursor: pointer;
		}

		.searchpin:hover {
			background-color: rgb(6, 6, 6);
		}

		.available {
			color: white;
			text-align: center;
			margin-top: 0;
			padding: 10px;
			font-size: 18px;
			text-decoration: underline;
			font-family: 'Open Sans', sans-serif;
			user-select: none;
		}

		.result {
			width: 90%;
			height: 100px;
			margin: auto;
			margin-bottom: 25px;
			user-select: none;
			border-radius: 8px;
		}

		.divleft {
			width: 73%;
			height: inherit;
			margin: 0;
			float: left;
			border-radius: 8px;
		}

		.divleft > .cname {
			margin-top: 4px;
			margin-left: 6px;
			font-size: 18px;
			color: rgb(217, 217, 217);
			font-weight: 500;
			font-family: 'Open Sans', sans-serif;
			word-wrap: break-word;
		}

		.divleft span{
			font-size: 17px;
			color: rgb(29,161,16);
		}

		.divleft > .address {
			color: rgb(92, 92, 92);
			margin-top: -4px;
			margin-left: 4px;
			font-size: 15px;
			font-weight: 500;
			font-family: 'Open Sans', sans-serif;
		}

		.divright {
			width: 26%;
			height: inherit;
			border: 0.5px solid rgb(18,72,158);
			border-radius: 2px;
			box-shadow: 0.3px 0.3px 2px rgb(217, 217, 217);
			float: right;
		}

		.divupper {
			width: 100%;
			height: 75%;
		}

		.divupper > p {
			color: rgb(217, 217, 217);
			margin: 0 !important;
			padding-top: 5px;
			text-align: center;
			font-size: 12px;
			font-weight: 500;
			font-family: 'Open Sans', sans-serif;
		}

		.divupper > .vaccine {
			font-size: 13px;
		}

		.divbelow {
			width: 100%;
			height: 25%;
			background-color: rgb(18,72,158);
			border-radius: 2px;
		}

		.divbelow > p {
			margin: 0;
			padding-top: 5px;
			color: rgb(217, 217, 217);
			text-align: center;
			font-size: 12px;
			font-weight: 500;
			font-family: 'Open Sans', sans-serif;
		}

	</style>
</head>
<body>
	<div class='main'>
		<div class='header'>
			<p>Vaccine Slot Availability</p>
		</div>
		<div class='logo'>
			<img src="logo.png">
		</div>
		<div class='searchdiv'>
			<button class='method bypin'>PINCODE</button>
			<button class='method bydist'>DISTRICT</button>
			<div class='box'></div>
		</div>
	</div>

	<script type="text/javascript">
		const body = document.querySelector('body');
		const searchdiv = document.querySelector('.searchdiv')
		const pinbtn = document.querySelector('.bypin');
		const distbtn = document.querySelector('.bydist');
		const box = document.querySelector('.box');

		const statedIDs = 

		body.onload = function(){
			pinbtn.click();
		}

		pinbtn.onclick = function() {
			pinbtn.style.color = 'rgb(120,148,213)';
			pinbtn.style.borderBottomColor = 'rgb(24,72,148)';
			distbtn.style.color = 'rgb(124,126,125)';
			distbtn.style.borderBottomColor = 'rgb(16,25,32)'

			searchbypinDOM();
		}

		distbtn.onclick = function() {
			distbtn.style.color = 'rgb(120,148,213)';
			distbtn.style.borderBottomColor = 'rgb(24,72,148)';
			pinbtn.style.color = 'rgb(124,126,125)';
			pinbtn.style.borderBottomColor = 'rgb(16,25,32)'

			searchbydistDOM();
		}

		function searchbypinDOM() {
			box.innerHTML = `
				<label> Pincode </label>
				<input type="input" class="getpin" placeholder="201010"><br/>
				<label class='labelup'> Date </label>
				<input type="input" class="getdate" placeholder="01-01-2022">
				<label> Dose </label>
				<input type="radio" name="dose" id="dose1" value="dose1"> <span class='radio'>Dose 1</span>
				<input type="radio" class="radio2" name="dose" id="dose2" value="dose1"> <span class='radio'>Dose 2</span>
				<button class='searchpin'> FIND A SLOT </button>
			`;

			var searchbypin = document.querySelector('.searchpin')
			searchbypin.onclick = function() {
				var pin = document.querySelector('.getpin');
				var date = document.querySelector('.getdate');
				var dose1 = document.querySelector('input[id="dose1"]');
				var dose2 = document.querySelector('input[id="dose2"]');
				var dose = ''; 
				if (dose1.checked) {
					dose = dose1.value;
				}
				else if (dose2.checked) {
					dose = dose2.value;
				}

				var apiendpoint = `https://cdn-api.co-vin.in/api/v2/appointment/sessions/public/findByPin?pincode=${pin.value}&date=${date.value}`;

				if (pin.value.length == 6 && date.value && dose){
					console.log(apiendpoint);
					fetch(apiendpoint)
					.then(response => response.json())
					.then(data => showResultByPin(data, dose));
				}
			}
		}

		function searchbydistDOM() {
			box.innerHTML = `
				<label> Pincode </label>
				<input type="input" class="getpin" placeholder="201010"><br/>
			`;
		}

		function showResultByPin(data, dose){
			searchdiv.innerHTML = `
				<p class='available'> Available slots </p>
			`;

			sessions = data["sessions"];
			for (var i=0; i<sessions.length; i++) {
				session = sessions[i];
				available_doses = session[`available_capacity_${dose}`]
				if (available_doses > 0) {
					var result = document.createElement('div')
					result.setAttribute('class', 'result')
					result.innerHTML = `
						<div class='divleft'> 
							<p class="cname">${session["name"]} <span>(${session["fee_type"]})</span></p>
							<p class="address">${session["address"]}, ${session["block_name"]}
						</div>
						<div class="divright">
							<div class="divupper">
								<p>${session["date"]}</p>
								<p class="vaccine">${session["vaccine"]}</p>
								<p>Age ${session["min_age_limit"]}+</p>
							</div>
							<div class="divbelow">
								<p>Book (${available_doses})</p>
							</div>
						</div>						
					`
					searchdiv.appendChild(result);
				}
			}
		}
	</script>
</body>
</html>